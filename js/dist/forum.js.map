{"version":3,"file":"forum.js","mappings":"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","sources":["webpack://@sycho/flarum-profile-cover/webpack/bootstrap","webpack://@sycho/flarum-profile-cover/webpack/runtime/compat get default export","webpack://@sycho/flarum-profile-cover/webpack/runtime/define property getters","webpack://@sycho/flarum-profile-cover/webpack/runtime/hasOwnProperty shorthand","webpack://@sycho/flarum-profile-cover/webpack/runtime/make namespace object","webpack://@sycho/flarum-profile-cover/external root \"flarum.reg.get('core', 'forum/app')\"","webpack://@sycho/flarum-profile-cover/external root \"flarum.reg.get('core', 'common/extend')\"","webpack://@sycho/flarum-profile-cover/external root \"flarum.reg.get('core', 'forum/components/UserCard')\"","webpack://@sycho/flarum-profile-cover/external root \"flarum.reg.get('core', 'forum/utils/UserControls')\"","webpack://@sycho/flarum-profile-cover/external root \"flarum.reg.get('core', 'common/components/Button')\"","webpack://@sycho/flarum-profile-cover/external root \"flarum.reg.get('core', 'common/components/Form')\"","webpack://@sycho/flarum-profile-cover/external root \"flarum.reg.get('core', 'common/components/Modal')\"","webpack://@sycho/flarum-profile-cover/external root \"flarum.reg.get('core', 'common/utils/ItemList')\"","webpack://@sycho/flarum-profile-cover/external root \"flarum.reg.get('core', 'common/components/LoadingIndicator')\"","webpack://@sycho/flarum-profile-cover/./src/common/formatBytes.js","webpack://@sycho/flarum-profile-cover/./src/forum/components/CoverEditorModal.js","webpack://@sycho/flarum-profile-cover/external root \"flarum.reg.get('core', 'common/extenders')\"","webpack://@sycho/flarum-profile-cover/external root \"flarum.reg.get('core', 'common/models/User')\"","webpack://@sycho/flarum-profile-cover/./src/forum/extend.ts","webpack://@sycho/flarum-profile-cover/./src/forum/index.tsx"],"sourcesContent":["// The require scope\nvar __webpack_require__ = {};\n\n","// getDefaultExport function for compatibility with non-harmony modules\n__webpack_require__.n = (module) => {\n\tvar getter = module && module.__esModule ?\n\t\t() => (module['default']) :\n\t\t() => (module);\n\t__webpack_require__.d(getter, { a: getter });\n\treturn getter;\n};","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.reg.get('core', 'forum/app');","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.reg.get('core', 'common/extend');","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.reg.get('core', 'forum/components/UserCard');","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.reg.get('core', 'forum/utils/UserControls');","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.reg.get('core', 'common/components/Button');","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.reg.get('core', 'common/components/Form');","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.reg.get('core', 'common/components/Modal');","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.reg.get('core', 'common/utils/ItemList');","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.reg.get('core', 'common/components/LoadingIndicator');","export default function formatBytes(bytes, decimals) {\n  if (decimals === void 0) {\n    decimals = 2;\n  }\n  if (bytes === 0) return '0 Bytes';\n  const k = 1024;\n  const dm = decimals < 0 ? 0 : decimals;\n  const sizes = ['Bytes', 'KB', 'MB', 'GB', 'TB', 'PB', 'EB', 'ZB', 'YB'];\n  const i = Math.floor(Math.log(bytes) / Math.log(k));\n  return parseFloat((bytes / Math.pow(k, i)).toFixed(dm)) + ' ' + sizes[i];\n}\nflarum.reg.add('sychoprofile-cover', 'common/formatBytes', formatBytes);","import Form from 'flarum/common/components/Form';\nimport app from 'flarum/forum/app';\nimport Modal from 'flarum/common/components/Modal';\nimport Button from 'flarum/common/components/Button';\nimport ItemList from 'flarum/common/utils/ItemList';\nimport LoadingIndicator from 'flarum/common/components/LoadingIndicator';\nimport formatBytes from '../../common/formatBytes';\nexport default class CoverEditorModal extends Modal {\n  oninit(vnode) {\n    super.oninit(vnode);\n    this.maxSize = parseFloat(app.forum.attribute('sycho-profile-cover.max_size') || 2048);\n    this.alertAttrs = {\n      content: app.translator.trans('sycho-profile-cover.forum.notice', {\n        size: formatBytes(this.maxSize * Math.pow(2, 10))\n      })\n    };\n    this.loading = false;\n    this.cover = this.attrs.user.cover_thumbnail() || this.attrs.user.cover();\n    this.context = '';\n  }\n  content() {\n    let attrs = {};\n    let className = 'Modal-image CoverEditor-cover';\n    if (this.cover) {\n      attrs.style = {\n        backgroundImage: \"url(\".concat(this.cover, \")\")\n      };\n      className += ' CoverEditor-active';\n    }\n    return [m(\"div\", Object.assign({\n      className: className\n    }, attrs), this.loading ? m(LoadingIndicator, null) : ''), m(\"div\", {\n      className: \"Modal-body\"\n    }, m(Form, {\n      className: \"Form--centered\"\n    }, this.fieldsItems().toArray()))];\n  }\n  className() {\n    return 'Cover-modal Modal--small';\n  }\n  title() {\n    return app.translator.trans('sycho-profile-cover.forum.edit_cover');\n  }\n  fieldsItems() {\n    const items = new ItemList();\n    items.add('actions', this.controlItems().toArray());\n    return items;\n  }\n  controlItems() {\n    const items = new ItemList();\n    items.add('upload', m(Button, {\n      icon: \"fas fa-upload\",\n      className: \"Button Button--block Button--primary\",\n      onclick: this.openPicker.bind(this)\n    }, app.translator.trans('core.forum.user.avatar_upload_button')));\n    items.add('remove', m(Button, {\n      icon: \"fas fa-times\",\n      className: \"Button Button--block\",\n      onclick: this.remove.bind(this)\n    }, app.translator.trans('core.forum.user.avatar_remove_button')));\n    return items;\n  }\n  openPicker() {\n    const input = $('<input type=\"file\">');\n    input.appendTo('body').hide().click().on('change', e => {\n      this.upload($(e.target)[0].files[0]);\n    });\n  }\n  upload(file) {\n    if (this.loading) return;\n    const data = new FormData();\n    data.append('cover', file);\n    this.loading = true;\n    this.context = 'added';\n    m.redraw();\n    app.request({\n      method: 'POST',\n      url: \"\".concat(app.forum.attribute('apiUrl'), \"/users/\").concat(this.attrs.user.id(), \"/cover\"),\n      serialize: raw => raw,\n      body: data\n    }).then(this.success.bind(this), this.failure.bind(this));\n  }\n  remove() {\n    this.loading = true;\n    this.context = 'removed';\n    m.redraw();\n    app.request({\n      method: 'DELETE',\n      url: \"\".concat(app.forum.attribute('apiUrl'), \"/users/\").concat(this.attrs.user.id(), \"/cover\")\n    }).then(this.success.bind(this), this.failure.bind(this));\n  }\n  success(response) {\n    app.store.pushPayload(response);\n    this.showAlert('success');\n    this.loading = false;\n    m.redraw();\n    this.hide();\n  }\n  failure() {\n    this.showAlert('error');\n    this.loading = false;\n    m.redraw();\n  }\n  showAlert(type) {\n    this.alertAttrs.content = app.translator.trans(\"sycho-profile-cover.forum.\".concat(this.context, \".\").concat(type));\n    this.alertAttrs.type = type;\n  }\n}\nflarum.reg.add('sychoprofile-cover', 'forum/components/CoverEditorModal', CoverEditorModal);","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.reg.get('core', 'common/extenders');","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.reg.get('core', 'common/models/User');","import Extend from 'flarum/common/extenders';\nimport User from \"flarum/common/models/User\";\nexport default [new Extend.Model(User).attribute('cover').attribute('cover_thumbnail').attribute('canSetProfileCover')];","import app from 'flarum/forum/app';\nimport { extend } from 'flarum/common/extend';\nimport UserCard from 'flarum/forum/components/UserCard';\nimport UserControls from 'flarum/forum/utils/UserControls';\nimport Button from 'flarum/common/components/Button';\nimport CoverEditorModal from './components/CoverEditorModal';\nexport { default as extend } from './extend';\napp.initializers.add('sycho-profile-cover', () => {\n  extend(UserCard.prototype, 'view', function (view) {\n    if (!view.attrs.style || !this.attrs.user.cover()) return;\n    let coverUrl = this.attrs.user.cover();\n    let thumbnailUrl = this.attrs.user.cover_thumbnail();\n    if (!coverUrl) return;\n    if (this.attrs.controlsButtonClassName.includes('Button--icon') && thumbnailUrl) {\n      coverUrl = thumbnailUrl;\n    }\n    view.attrs.style = Object.assign(view.attrs.style, {\n      '--background-image': \"url(\".concat(coverUrl, \")\")\n    });\n  });\n  extend(UserControls, 'moderationControls', function (items, user) {\n    if (!user.canSetProfileCover()) return;\n    items.add('cover', m(Button, {\n      icon: \"fas fa-image\",\n      onclick: () => app.modal.show(CoverEditorModal, {\n        user\n      })\n    }, app.translator.trans('sycho-profile-cover.forum.cover')));\n    return items;\n  });\n});"],"names":["__webpack_require__","module","getter","__esModule","d","a","exports","definition","key","o","Object","defineProperty","enumerable","get","obj","prop","prototype","hasOwnProperty","call","Symbol","toStringTag","value","flarum","reg","formatBytes","bytes","decimals","dm","i","Math","floor","log","parseFloat","pow","toFixed","add","CoverEditorModal","oninit","vnode","super","this","maxSize","attribute","alertAttrs","content","trans","size","loading","cover","attrs","user","cover_thumbnail","context","className","style","backgroundImage","concat","m","assign","fieldsItems","toArray","title","items","controlItems","icon","onclick","openPicker","bind","remove","$","appendTo","hide","click","on","e","upload","target","files","file","data","FormData","append","redraw","method","url","id","serialize","raw","body","then","success","failure","response","pushPayload","showAlert","type","extend","view","coverUrl","thumbnailUrl","controlsButtonClassName","includes","canSetProfileCover","show"],"sourceRoot":""}