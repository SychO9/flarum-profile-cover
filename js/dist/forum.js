(()=>{var t={n:r=>{var o=r&&r.__esModule?()=>r.default:()=>r;return t.d(o,{a:o}),o},d:(r,o)=>{for(var e in o)t.o(o,e)&&!t.o(r,e)&&Object.defineProperty(r,e,{enumerable:!0,get:o[e]})},o:(t,r)=>Object.prototype.hasOwnProperty.call(t,r),r:t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}},r={};(()=>{"use strict";t.r(r);const o=flarum.core.compat["forum/app"];var e=t.n(o);const a=flarum.core.compat.extend,n=flarum.core.compat["models/User"];var s=t.n(n);const i=flarum.core.compat["components/UserCard"];var c=t.n(i);const u=flarum.core.compat["utils/UserControls"];var l=t.n(u);const d=flarum.core.compat["components/Button"];var f=t.n(d);const h=flarum.core.compat.Model;var p=t.n(h);function v(t,r){return v=Object.setPrototypeOf||function(t,r){return t.__proto__=r,t},v(t,r)}const y=flarum.core.compat["components/Modal"];var b=t.n(y);const g=flarum.core.compat["utils/ItemList"];var _=t.n(g);const w=flarum.core.compat["components/LoadingIndicator"];var B=t.n(w);function M(t,r){if(void 0===r&&(r=2),0===t)return"0 Bytes";var o=r<0?0:r,e=Math.floor(Math.log(t)/Math.log(1024));return parseFloat((t/Math.pow(1024,e)).toFixed(o))+" "+["Bytes","KB","MB","GB","TB","PB","EB","ZB","YB"][e]}var P=function(t){var r,o;function a(){return t.apply(this,arguments)||this}o=t,(r=a).prototype=Object.create(o.prototype),r.prototype.constructor=r,v(r,o);var n=a.prototype;return n.oninit=function(r){t.prototype.oninit.call(this,r),this.maxSize=parseFloat(e().forum.attribute("sycho-profile-cover.max_size")||2048),this.alertAttrs={content:e().translator.trans("sycho-profile-cover.forum.notice",{size:M(this.maxSize*Math.pow(2,10))})},this.loading=!1,this.cover=this.attrs.user.cover_thumbnail()||this.attrs.user.cover(),this.context=""},n.content=function(){var t={},r="Modal-image CoverEditor-cover";return this.cover&&(t.style={backgroundImage:"url("+this.cover+")"},r+=" CoverEditor-active"),[m("div",Object.assign({className:r},t),this.loading?m(B(),null):""),m("div",{className:"Modal-body"},m("div",{className:"Form"},this.fieldsItems().toArray()))]},n.className=function(){return"Cover-modal Modal--small"},n.title=function(){return e().translator.trans("sycho-profile-cover.forum.edit_cover")},n.fieldsItems=function(){var t=new(_());return t.add("actions",this.controlItems().toArray()),t},n.controlItems=function(){var t=new(_());return t.add("upload",m(f(),{icon:"fas fa-upload",className:"Button",onclick:this.openPicker.bind(this)},e().translator.trans("core.forum.user.avatar_upload_button"))),t.add("remove",m(f(),{icon:"fas fa-times",className:"Button",onclick:this.remove.bind(this)},e().translator.trans("core.forum.user.avatar_remove_button"))),t},n.openPicker=function(){var t=this;$('<input type="file">').appendTo("body").hide().click().on("change",(function(r){t.upload($(r.target)[0].files[0])}))},n.upload=function(t){if(!this.loading){var r=new FormData;r.append("cover",t),this.loading=!0,this.context="added",m.redraw(),e().request({method:"POST",url:e().forum.attribute("apiUrl")+"/users/"+this.attrs.user.id()+"/cover",serialize:function(t){return t},body:r}).then(this.success.bind(this),this.failure.bind(this))}},n.remove=function(){this.loading=!0,this.context="removed",m.redraw(),e().request({method:"DELETE",url:e().forum.attribute("apiUrl")+"/users/"+this.attrs.user.id()+"/cover"}).then(this.success.bind(this),this.failure.bind(this))},n.success=function(t){e().store.pushPayload(t),this.showAlert("success"),this.loading=!1,m.redraw(),this.hide()},n.failure=function(){this.showAlert("error"),this.loading=!1,m.redraw()},n.showAlert=function(t){this.alertAttrs.content=e().translator.trans("sycho-profile-cover.forum."+this.context+"."+t),this.alertAttrs.type=t},a}(b());e().initializers.add("sycho-profile-cover",(function(){s().prototype.cover=p().attribute("cover"),s().prototype.cover_thumbnail=p().attribute("cover_thumbnail"),s().prototype.canSetProfileCover=p().attribute("canSetProfileCover"),(0,a.extend)(c().prototype,"view",(function(t){if(t.attrs.style&&this.attrs.user.cover()){var r=this.attrs.user.cover(),o=this.attrs.user.cover_thumbnail();r&&(this.attrs.controlsButtonClassName.includes("Button--icon")&&o&&(r=o),t.attrs.style=Object.assign(t.attrs.style,{"--background-image":"url("+r+")"}))}})),(0,a.extend)(l(),"moderationControls",(function(t,r){if(r.canSetProfileCover())return t.add("cover",m(f(),{icon:"fas fa-image",onclick:function(){return e().modal.show(P,{user:r})}},e().translator.trans("sycho-profile-cover.forum.cover"))),t}))}))})(),module.exports=r})();
//# sourceMappingURL=forum.js.map