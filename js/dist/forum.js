(()=>{var t={n:e=>{var r=e&&e.__esModule?()=>e.default:()=>e;return t.d(r,{a:r}),r},d:(e,r)=>{for(var o in r)t.o(r,o)&&!t.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:r[o]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e),r:t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}},e={};(()=>{"use strict";t.r(e);const r=flarum.reg.get("core","forum/app");var o=t.n(r);const s=flarum.reg.get("core","extend"),a=flarum.reg.get("core","models/User");var n=t.n(a);const i=flarum.reg.get("core","components/UserCard");var c=t.n(i);const l=flarum.reg.get("core","utils/UserControls");var u=t.n(l);const d=flarum.reg.get("core","components/Button");var h=t.n(d);const f=flarum.reg.get("core","Model");var v=t.n(f);const p=flarum.reg.get("core","common/components/Form");var g=t.n(p);const y=flarum.reg.get("core","components/Modal");var b=t.n(y);const B=flarum.reg.get("core","utils/ItemList");var w=t.n(B);const M=flarum.reg.get("core","components/LoadingIndicator");var _=t.n(M);function x(t,e){if(void 0===e&&(e=2),0===t)return"0 Bytes";const r=e<0?0:e,o=Math.floor(Math.log(t)/Math.log(1024));return parseFloat((t/Math.pow(1024,o)).toFixed(r))+" "+["Bytes","KB","MB","GB","TB","PB","EB","ZB","YB"][o]}flarum.reg.add("sychoprofile-cover","common/formatBytes",x);class P extends(b()){oninit(t){super.oninit(t),this.maxSize=parseFloat(o().forum.attribute("sycho-profile-cover.max_size")||2048),this.alertAttrs={content:o().translator.trans("sycho-profile-cover.forum.notice",{size:x(this.maxSize*Math.pow(2,10))})},this.loading=!1,this.cover=this.attrs.user.cover_thumbnail()||this.attrs.user.cover(),this.context=""}content(){let t={},e="Modal-image CoverEditor-cover";return this.cover&&(t.style={backgroundImage:"url(".concat(this.cover,")")},e+=" CoverEditor-active"),[m("div",Object.assign({className:e},t),this.loading?m(_(),null):""),m("div",{className:"Modal-body"},m(g(),null,this.fieldsItems().toArray()))]}className(){return"Cover-modal Modal--small"}title(){return o().translator.trans("sycho-profile-cover.forum.edit_cover")}fieldsItems(){const t=new(w());return t.add("actions",this.controlItems().toArray()),t}controlItems(){const t=new(w());return t.add("upload",m(h(),{icon:"fas fa-upload",className:"Button",onclick:this.openPicker.bind(this)},o().translator.trans("core.forum.user.avatar_upload_button"))),t.add("remove",m(h(),{icon:"fas fa-times",className:"Button",onclick:this.remove.bind(this)},o().translator.trans("core.forum.user.avatar_remove_button"))),t}openPicker(){$('<input type="file">').appendTo("body").hide().click().on("change",(t=>{this.upload($(t.target)[0].files[0])}))}upload(t){if(this.loading)return;const e=new FormData;e.append("cover",t),this.loading=!0,this.context="added",m.redraw(),o().request({method:"POST",url:"".concat(o().forum.attribute("apiUrl"),"/users/").concat(this.attrs.user.id(),"/cover"),serialize:t=>t,body:e}).then(this.success.bind(this),this.failure.bind(this))}remove(){this.loading=!0,this.context="removed",m.redraw(),o().request({method:"DELETE",url:"".concat(o().forum.attribute("apiUrl"),"/users/").concat(this.attrs.user.id(),"/cover")}).then(this.success.bind(this),this.failure.bind(this))}success(t){o().store.pushPayload(t),this.showAlert("success"),this.loading=!1,m.redraw(),this.hide()}failure(){this.showAlert("error"),this.loading=!1,m.redraw()}showAlert(t){this.alertAttrs.content=o().translator.trans("sycho-profile-cover.forum.".concat(this.context,".").concat(t)),this.alertAttrs.type=t}}flarum.reg.add("sychoprofile-cover","forum/components/CoverEditorModal",P),o().initializers.add("sycho-profile-cover",(()=>{n().prototype.cover=v().attribute("cover"),n().prototype.cover_thumbnail=v().attribute("cover_thumbnail"),n().prototype.canSetProfileCover=v().attribute("canSetProfileCover"),(0,s.extend)(c().prototype,"view",(function(t){if(!t.attrs.style||!this.attrs.user.cover())return;let e=this.attrs.user.cover(),r=this.attrs.user.cover_thumbnail();e&&(this.attrs.controlsButtonClassName.includes("Button--icon")&&r&&(e=r),t.attrs.style=Object.assign(t.attrs.style,{"--background-image":"url(".concat(e,")")}))})),(0,s.extend)(u(),"moderationControls",(function(t,e){if(e.canSetProfileCover())return t.add("cover",m(h(),{icon:"fas fa-image",onclick:()=>o().modal.show(P,{user:e})},o().translator.trans("sycho-profile-cover.forum.cover"))),t}))}))})(),module.exports=e})();
//# sourceMappingURL=forum.js.map